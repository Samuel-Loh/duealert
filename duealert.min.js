function sH(t){let r=0;for(let e=0;e<t.length;e++){var n=t.charCodeAt(e);r=(r<<5)-r+n,r&=r}return r}let LSC=1418846409,RSC=-491603745;function vS(){var e=document.querySelector(".lsb"),t=document.querySelector(".rsb");return!(!e||!t)&&(e=sH(e.innerHTML.replace(/\s+/g,"")),t=sH(t.innerHTML.replace(/\s+/g,"")),e===LSC)&&t===RSC}function main(){function i(e){e=new Date(864e5*(e-25569)),e=new Date(e.getTime()+60*e.getTimezoneOffset()*1e3);return new Date(e.getFullYear(),e.getMonth(),e.getDate())}function D(e){return e.getFullYear()+`-${String(e.getMonth()+1).padStart(2,"0")}-`+String(e.getDate()).padStart(2,"0")}function m(e){return e.replace(/[,;\\]/g,"\\$&").replace(/\n/g,"\\n")}let s=D(new Date);document.getElementById("today").textContent=s,document.getElementById("fileInput").addEventListener("change",function(e){var e=e.target.files[0],t=new FileReader;let u=document.getElementById("message"),o=document.getElementById("result"),l=parseInt(document.getElementById("alertDays").value,10),c=document.getElementById("fileFormat").value;u.textContent="Processing "+e.name,o.innerHTML="",t.onload=function(e){var e=new Uint8Array(e.target.result),e=XLSX.read(e,{type:"array"}),t=e.SheetNames[0],e=e.Sheets[t],t=XLSX.utils.sheet_to_json(e).filter(e=>{return"number"==typeof e.due_date&&D(i(e.due_date))>=s}).sort((e,t)=>e.due_date-t.due_date),e=t.map(e=>({due_date:D(i(e.due_date)),summary:e.summary||"",description:e.description||""}));let r,n,a;a="ics"===c?(r=function(e,n){let a="BEGIN:VCALENDAR\r\nVERSION:2.0\r\nPRODID:-//DueAlert//EN\r\n";return e.forEach(e=>{var t=i(e.due_date),r=e.summary||"No Summary",e=e.description||"No Description",e=(a=(a=(a=(a=(a+="BEGIN:VEVENT\r\n")+`DTSTART;VALUE=DATE:${D(t).replace(/-/g,"")}\r
`)+`DTEND;VALUE=DATE:${D(new Date(t.getTime()+864e5)).replace(/-/g,"")}\r
`)+`SUMMARY:${m(r)}\r
`)+`DESCRIPTION:${m(e)}\r
`,new Date(t.getTime()-24*n*60*60*1e3));a=(a=(a=(a+="BEGIN:VALARM\r\nACTION:DISPLAY\r\n")+`TRIGGER;VALUE=DATE-TIME:${D(e).replace(/-/g,"")}T000000Z\r
`)+`DESCRIPTION:Reminder: ${m(r)}\r
`)+"END:VALARM\r\nEND:VEVENT\r\n"}),a+="END:VCALENDAR\r\n"}(t,l),n="text/calendar;charset=utf-8","ics"):(r=function(e,n){let a="BEGIN:VCALENDAR\r\nVERSION:2.0\r\nPRODID:-//DueAlert//EN\r\n";return e.forEach(e=>{var t=i(e.due_date),r=e.summary||"No Summary",e=e.description||"No Description",e=(a=(a=(a=(a=(a+="BEGIN:VEVENT\r\n")+`DTSTART;VALUE=DATE:${D(t).replace(/-/g,"")}\r
`)+`DTEND;VALUE=DATE:${D(new Date(t.getTime()+864e5)).replace(/-/g,"")}\r
`)+`SUMMARY:${m(r)}\r
`)+`DESCRIPTION:${m(e)}\r
`,new Date(t.getTime()-24*n*60*60*1e3));a=(a=(a=(a+="BEGIN:VALARM\r\nACTION:DISPLAY\r\n")+`TRIGGER;VALUE=DATE-TIME:${D(e).replace(/-/g,"")}T000000Z\r
`)+`DESCRIPTION:Reminder: ${m(r)}\r
`)+"END:VALARM\r\nEND:VEVENT\r\n"}),a+="END:VCALENDAR\r\n"}(t,l),n="text/x-vcalendar;charset=utf-8","vcs");var t=new Blob([r],{type:n}),t=URL.createObjectURL(t),d=document.createElement("a");d.href=t,d.download=`DueAlert-events-${s}.`+a,d.textContent=`Download Calendar Events (${a.toUpperCase()})`,u.textContent="",u.appendChild(d);let E="<table><tr><th>Due Date</th><th>Summary</th><th>Description</th></tr>";e.forEach(e=>{E+=`<tr><td>${e.due_date}</td><td>${e.summary}</td><td>${e.description}</td></tr>`}),E+="</table>",o.innerHTML="<h2>Upcoming Events</h2>"+E},t.readAsArrayBuffer(e)})}vS()&&main();
